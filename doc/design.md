# Design Documentation

## Third Party Code

### Gems
+ `anjlab-bootstrap-rails` - Adds Twitter Bootstrap for CSS components such as visual styles, icon font, and grids (for responsiveness). Preferred out of all Bootstrap rubygems as it is the most up-to-date (with Rails and Bootstrap versions) and uses SASS rather than LESS.
+ `devise` - Out-of-the-box user authentication implementation with support for sign up, sign in, and forgotten/changing passwords.
+ `font_assets` - Enables asset precompilation for Glyphicons font.
+ `friendly_id` - Generates readable slugs for notes to be used as primary keys.
+ `rails_12factor` - Enables Rails 4 asset precompilation for Heroku.
+ `simple_form` - Allows for more flexible form generation, including an association helper.

### Plugins
+ `chosen.jquery.js` - Turns multiple select boxes into text input tokenizers ("tagging" interfaces).

## Overview

### Note

The primary ActiveRecord resource for this web app. Has two user-accessible fields, `title` and `content`. `has_many` Users `through` Permissions. For the most part, this resource is unchanged from the auto-generated Rails scaffolding. Handles basic RESTful methods: `create`, `edit`, `destroy`, `show`. What follows is a discussion of modifications to the scaffold defaults.

#### Model

##### Fields

+ `title` - A string representing the name of the note.
+ `content` - A text object containing the body of the note. For the next phase of the project, I plan to abstract this field out into a separate Revision model (joined via a `has_many` relationship) that will allow for version control and some level of concurrency in editing.
+ `slug` - A string object generated by the `friendly_id` rubygem from `title`, used as a human-friendly alternative to `id`. At the moment, this is not updated when the note is renamed and a note that shares a name with an existing note is assigned <slug>--<UUID> as its slug. These issues stem from design choices made by the gem maintainer. Changing this was nonessential to the minimum viable product and was left out of the scope of the project.

#### Associations

`has_many` Users `through` Permissions. There is no longer any concept of "ownership" â€” any User with Permission to view/edit a Note has equal powers (e.g. to delete it, or remove other editors). Each note can be edited by multiple Users, and each User can edit multiple Notes. Was initially implemented as a `has_many :through` rather than as `has_and_belongs_to_many` relationship so that Permissions could hold additional attributes, but these were removed for the final product (see Design Challenges section).

#### Controller

##### `new`, `edit`
Intentionally hides the current user from the list of users that a document can be shared with. See Design Challenges for rationale.

##### `create`

Creates a new Note and the relevant Permissions. Modifies the `note_params` input because Rails can't seem to directly interpret the `user_ids` attribute produced by `simple_form`'s association helper (working theory: it's because I used a `has_many :through` association). Instead, the controller strips this parameter from the input and deals with them separately, creating Permissions for each specified User.

##### `edit`

Once again, strips `user_ids` attribute from `note_params` and deals with it directly. Performs an ActiveRecord lookup to find all Permissions for the edited Note that are associated with Users not included in the list, then deletes these associations.

##### `update`

##### `set_note`
Permits the `user_ids` parameter created by `simple_form`'s association helper, and "seeds" it as an empty array.

##### `index`

Shows a list of all notes and allows for sorting on title, note length, and last updated datetime via the Table data type in `notes.js.coffee`. Given the css selector for a valid table, this snippet allows for ascending/descending sort on any of its columns.

#### Views

Styling done using Twitter Bootstrap, SASS, and colors chosen from the [Flat UI palette](http://flatuicolors.com/). Significant visual inspiration derived from [Medium](http://medium.com). The form partial has been modified to make use of the `simple_form` gem and `chosen.jquery.js` plugin.

Note deletion has actually been implemented since the first phase, but was only accessible from the `edit` view. This is to avoid accidental deletion (and makes sense, as deletion could be considered a subtask of editing). The alternative was to create a confirmation dialog, but I did not like the default alert window (and after some research, decided that implementing these dialogs via modals was out of scope).

### User/Permission

## Design Challenges

### Data model for multiple users

* Challenge:* Modify the initial user-to-note relationship to allow for multiple users.

+ *First approach:* `has_many :through` via Permission join model, which had an additional field `access` which denoted between read and read-write permissions. Still kept the original ownership parallel to this, which caused a lot of problems down the line in terms of differentiating between the two associations.

+ *Second approach:* Removed ownership and treated the creator as just another User with the relevant Permission. However, the `access` field was also problematic as Rails has trouble accessing the attributes of join models. Furthermore, I was unsure of how to implement a user interface that would differentiate between the two levels of access and ultimately left this out of the scope of the final product.

+ *Final approach:* Reduced the association to what was essentially a basic `has_and_belongs_to_many` relationship between Notes and Users. On the view side, used the `chosen.jquery.js` plugin to significantly simplify the resulting interface. Removed `current_user` from the candidate list to circumvent the possibility of a User accidentally removing themselves from a Note, which could result in orphaned Notes. In cases where this behavior was intentional, the User could be removed by another User (presumably, the future maintainer of the Note) or simply delete the Note if it is no longer needed.

